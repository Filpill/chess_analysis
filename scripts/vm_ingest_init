gcloud compute instances create-with-container vm-chess-ingestion \
    --project=checkmate-453316 \
    --zone=europe-west2-c \
    --machine-type=e2-medium \
    --network-interface=network-tier=PREMIUM,stack-type=IPV4_ONLY,subnet=filip-vpc \
    --maintenance-policy=MIGRATE \
    --provisioning-model=STANDARD \
    --service-account=startvm-sa@checkmate-453316.iam.gserviceaccount.com \
    --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/trace.append \
    --image=projects/cos-cloud/global/images/cos-stable-117-18613-164-98 \
    --boot-disk-size=10GB \
    --boot-disk-type=pd-balanced \
    --boot-disk-device-name=vm-chess-ingestion \
    --container-image=europe-west2-docker.pkg.dev/checkmate-453316/docker-chess-repo/chess_ingestion_processor:v001 \
    --container-restart-policy=never \
    --no-shielded-secure-boot \
    --shielded-vtpm \
    --shielded-integrity-monitoring \
    --labels=goog-ec-src=vm_add-gcloud,container-vm=cos-stable-117-18613-164-98 \
&& \
gcloud compute resource-policies create snapshot-schedule default-schedule-1 \
    --project=checkmate-453316 \
    --region=europe-west2 \
    --max-retention-days=14 \
    --on-source-disk-delete=keep-auto-snapshots \
    --daily-schedule \
    --start-time=04:00 \
&& \
gcloud compute disks add-resource-policies vm-chess-ingestion \
    --project=checkmate-453316 \
    --zone=europe-west2-c \
    --resource-policies=projects/checkmate-453316/regions/europe-west2/resourcePolicies/default-schedule-1
